<p-toast></p-toast>

<div class="p-4">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">My Addresses</h1>
    <div class="flex gap-2">
      <p-button label="Add Address" icon="pi pi-plus" (onClick)="navigateToAddAddress()" />
      <p-button
        label="Edit Profile"
        icon="pi pi-user"
        severity="secondary"
        (onClick)="navigateToProfile()"
      />
    </div>
  </div>

  <p-table
    #dt
    [value]="addresses()"
    [tableStyle]="{ 'min-width': '50rem' }"
    [globalFilterFields]="['address', 'totalBins', 'addressStatus', 'addressNotes']"
    [scrollable]="true"
    scrollHeight="70vh"
  >
    <ng-template pTemplate="caption">
      <p-iconField iconPosition="left" class="w-full">
        <p-inputIcon>
          <i class="pi pi-search"></i>
        </p-inputIcon>
        <input
          pInputText
          type="text"
          (input)="dt.filterGlobal($event.target.value, 'contains')"
          placeholder="Search Addresses"
          class="w-full"
        />
      </p-iconField>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="address">
          Address
          <p-sortIcon field="address"></p-sortIcon>
        </th>
        <th pSortableColumn="totalBins">
          Bins
          <p-sortIcon field="totalBins"></p-sortIcon>
        </th>
        <th pSortableColumn="addressStatus">
          Status
          <p-sortIcon field="addressStatus"></p-sortIcon>
        </th>
        <th>Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-address>
      <tr>
        <td>{{ address.address }}</td>
        <td>{{ address.totalBins }}</td>
        <td>
          @switch (address.addressStatus) {
            @case ('BinRequested') {
              <p-tag severity="info" value="Bin Requested"></p-tag>
            }
            @case ('PendingBinPayment') {
              <p-tag severity="warn" value="Pending Payment"></p-tag>
            }
            @case ('PendingBinDelivery') {
              <p-tag severity="info" value="Pending Delivery"></p-tag>
            }
            @case ('BinDelivered') {
              <p-tag severity="success" value="Delivered"></p-tag>
            }
            @default {
              <p-tag severity="secondary" value="Pending"></p-tag>
            }
          }
        </td>
        <td>
          <p-button
            icon="pi pi-eye"
            severity="info"
            [text]="true"
            (onClick)="viewAddress(address.id)"
            pTooltip="View Details"
          />
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center p-4">
          <div class="flex flex-col items-center gap-2">
            <i class="pi pi-inbox text-4xl text-gray-400"></i>
            <p class="text-gray-500">No addresses found</p>
            <p-button
              label="Add Your First Address"
              icon="pi pi-plus"
              (onClick)="navigateToAddAddress()"
            />
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
